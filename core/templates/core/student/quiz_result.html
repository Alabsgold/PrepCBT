{% extends 'core/base.html' %}

{% block title %}Quiz Result - PrepCBT{% endblock %}

{% comment %} 
Alabi's Note: I've created a new block 'head_styles'. 
You should define this in your base.html inside the <head> tag. 
e.g. <head> ... {% block head_styles %}{% endblock %} </head> 
This is the correct place for page-specific styles.
{% endcomment %}
{% block head_styles %}
<style>
    .circular-chart {
        display: block;
    }
    .circle-bg {
        fill: none;
        stroke: #eee;
        stroke-width: 3.8;
    }
    .circle {
        fill: none;
        stroke-width: 2.8;
        stroke-linecap: round;
        stroke: {{ performance.color_hex }}; /* <-- Logic removed, now uses a variable */
        animation: progress 1s ease-out forwards;
    }
    @keyframes progress {
        0% { stroke-dasharray: 0 100; }
    }
    .percentage {
        fill: #666;
        font-family: sans-serif;
        font-size: 0.5em;
        text-anchor: middle;
    }
</style>
{% endblock %}

{% block content %}
<div class="card text-center">
    <div class="card-header">
        <h3>Quiz Results</h3>
    </div>
    <div class="card-body">
        <h4>{{ quiz.title }}</h4>
        <p class="text-muted">Subject: {{ quiz.subject }}</p>
        
        <div class="result-circle mx-auto mb-4">
            <div class="position-relative" style="width: 150px; height: 150px;">
                <svg class="circular-chart" viewBox="0 0 36 36" width="150" height="150">
                    {% comment %} Alabi's Note: Fixed the broken path attribute string. {% endcomment %}
                    <path class="circle-bg"
                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                    />
                    <path class="circle"
                        stroke-dasharray="{{ result.score }}, 100"
                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                    />
                    <text x="18" y="20.35" class="percentage">{{ result.score|floatformat:1 }}%</text>
                </svg>
            </div>
        </div>
        
        {% comment %} 
        Alabi's Note: See how clean this is? One variable controls the class. No repetition. 
        {% endcomment %}
        <div class="alert alert-{{ performance.status }}">
            <h5>{{ performance.message }}</h5>
        </div>
        
        <div class="mt-4">
            <a href="{% url 'review_quiz' quiz.id %}" class="btn btn-primary">Review Answers</a>
            <a href="{% url 'student_dashboard' %}" class="btn btn-secondary">Back to Dashboard</a>
        </div>
    </div>
    <div class="card-footer text-muted">
        Completed on: {{ result.completed_on|date:"F j, Y, g:i a" }}
    </div>
</div>
{% endblock %}